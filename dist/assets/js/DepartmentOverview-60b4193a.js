import{j as t,a as s}from"./index-d35fa7e7.js";import{r as x}from"./react-vendor-07fa9950.js";function B(){const[c,S]=x.useState(()=>{const i=localStorage.getItem("auth");return i?JSON.parse(i):null}),[n,y]=x.useState(null),[R,w]=x.useState([]),[k,j]=x.useState([]),[D,_]=x.useState(!0);x.useEffect(()=>{c&&c.role==="hod"&&M()},[c]);const M=async()=>{try{const[i,g]=await Promise.all([fetch(`/api/marksheets?department=${c.department}&includeAll=true`),fetch("/api/users")]),b=await i.json(),N=await g.json();if(b.success){const l=b.marksheets,f=N.success?N.users:[],h={};f.forEach(e=>{e.id&&(h[e.id]=e,h[e.id.toString()]=e),e._id&&(h[e._id]=e,h[e._id.toString()]=e)}),console.log("=== Department Overview Debug ==="),console.log("Total marksheets:",l.length),console.log("Total users fetched:",f.length),l.length>0&&console.log("Sample marksheet:",{staffId:l[0].staffId,staffName:l[0].staffName}),f.length>0&&console.log("All users:",f.map(e=>({id:e.id,name:e.name,role:e.role,year:e.year,section:e.section,department:e.department}))),console.log("UserMap keys:",Object.keys(h)),console.log("=== End Debug ===");const p={totalMarksheets:l.length,totalStudents:new Set(l.map(e=>{var a;return(a=e.studentDetails)==null?void 0:a.regNumber})).size,byClass:{},byStatus:{draft:l.filter(e=>e.status==="draft").length,verified:l.filter(e=>e.status==="verified_by_staff").length,pending:l.filter(e=>e.status==="dispatch_requested").length,rescheduled:l.filter(e=>e.status==="rescheduled_by_hod").length,approved:l.filter(e=>e.status==="approved_by_hod").length,rejected:l.filter(e=>e.status==="rejected_by_hod").length,dispatched:l.filter(e=>e.status==="dispatched").length},completionRate:l.length>0?Math.round(l.filter(e=>e.status==="dispatched").length/l.length*100):0,pendingActions:l.filter(e=>e.status==="dispatch_requested"||e.status==="rescheduled_by_hod").length};l.forEach(e=>{var r;const a=((r=e.studentDetails)==null?void 0:r.year)||"Unknown";p.byClass[a]||(p.byClass[a]=0),p.byClass[a]++});const A=l.sort((e,a)=>new Date(a.updatedAt)-new Date(e.updatedAt)).slice(0,10).map(e=>{var a,r,d;return{id:e._id,student:((a=e.studentDetails)==null?void 0:a.name)||"Unknown",regNumber:((r=e.studentDetails)==null?void 0:r.regNumber)||"N/A",status:e.status,updatedAt:e.updatedAt,examination:((d=e.examination)==null?void 0:d.name)||"N/A"}}),m={};l.forEach(e=>{var r,d;const a=(e.staffId||e.createdBy||e.userId||"Unknown").toString();if(!m[a]){const o=h[a],u=(o==null?void 0:o.name)||e.staffName||"Unknown Staff",v=((r=e.studentDetails)==null?void 0:r.year)||null,L=((d=e.studentDetails)==null?void 0:d.section)||null;!o&&a!=="Unknown"&&(console.log("Staff not found for ID:",a),console.log("Using fallback staffName:",e.staffName)),m[a]={total:0,verified:0,dispatched:0,staffName:u,year:v,section:L}}m[a].total++,(e.status==="verified_by_staff"||e.status==="dispatch_requested"||e.status==="approved_by_hod"||e.status==="dispatched")&&m[a].verified++,e.status==="dispatched"&&m[a].dispatched++});const C=Object.entries(m).map(([e,a])=>{var u,v;const r=((u=a.year)==null?void 0:u.toString().trim())||null,d=((v=a.section)==null?void 0:v.toString().trim())||null;let o="N/A";return r&&d?o=`${r}-${d}`:r?o=r:d&&(o=d),Object.keys(m).indexOf(e)===0&&console.log("First staff stats:",{id:e,staffName:a.staffName,year:a.year,section:a.section,className:o}),{staffId:e,staffName:a.staffName,className:o,total:a.total,verified:a.verified,dispatched:a.dispatched,completionRate:a.total>0?Math.round(a.dispatched/a.total*100):0}}).sort((e,a)=>a.completionRate-e.completionRate);y(p),w(A),j(C)}}catch(i){console.error("Error fetching department data:",i)}finally{_(!1)}};return!c||c.role!=="hod"?t("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 flex items-center justify-center",children:s("div",{className:"glass-card p-8 rounded-3xl text-center",children:[t("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),t("p",{className:"text-gray-600",children:"Only HODs can view department overview."})]})}):t("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 no-mobile-anim",children:t("div",{className:"responsive-container py-6 md:py-8",children:s("div",{className:"max-w-7xl mx-auto",children:[t("div",{className:"mb-6 md:mb-8",children:t("div",{className:"glass-card no-mobile-backdrop responsive-spacing rounded-3xl",children:s("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[s("div",{children:[t("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-black text-[#111418] mb-2",children:"Department Overview"}),s("p",{className:"text-base sm:text-lg text-gray-600",children:["Real-time overview for ",c.department," Department"]})]}),s("div",{className:"flex flex-wrap items-center gap-3",children:[s("div",{className:"glass-card px-3 py-2 rounded-xl",children:[t("div",{className:"text-xs text-gray-500",children:"Students"}),t("div",{className:"text-xl md:text-2xl font-bold text-theme-gold-600",children:(n==null?void 0:n.totalStudents)||0})]}),s("div",{className:"glass-card px-3 py-2 rounded-xl",children:[t("div",{className:"text-xs text-gray-500",children:"Completion"}),s("div",{className:"text-xl md:text-2xl font-bold text-green-600",children:[(n==null?void 0:n.completionRate)||0,"%"]})]}),s("div",{className:"glass-card px-3 py-2 rounded-xl",children:[t("div",{className:"text-xs text-gray-500",children:"Pending"}),t("div",{className:"text-xl md:text-2xl font-bold text-yellow-600",children:(n==null?void 0:n.pendingActions)||0})]})]})]})})}),t("div",{className:"glass-card no-mobile-backdrop responsive-spacing rounded-3xl mb-6 md:mb-8",children:D?s("div",{className:"text-center py-12",children:[t("div",{className:"loading-spinner mx-auto mb-4"}),t("p",{className:"responsive-text text-gray-600",children:"Loading department data..."})]}):s("div",{className:"space-y-6 md:space-y-8",children:[s("div",{children:[s("div",{className:"flex items-center gap-2 mb-4",children:[t("svg",{className:"w-5 h-5 md:w-6 md:h-6 text-theme-gold-600 inline-flex",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{marginTop:"-2px"},children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),t("h2",{className:"responsive-heading-2 text-gray-900",children:"Year-wise Distribution"})]}),t("div",{className:"responsive-grid responsive-grid-2 md:grid-cols-4",children:Object.entries((n==null?void 0:n.byClass)||{}).map(([i,g])=>t("div",{className:"responsive-card bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-blue-200 hover:shadow-lg transition-all duration-300",children:s("div",{className:"flex items-center justify-between",children:[s("div",{children:[s("p",{className:"text-xs md:text-sm text-blue-600 font-medium mb-1",children:["Year ",i]}),t("p",{className:"text-2xl md:text-3xl font-bold text-blue-700",children:g})]}),t("svg",{className:"w-8 h-8 md:w-10 md:h-10 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})]})},i))})]}),s("div",{children:[s("div",{className:"flex items-center gap-2 mb-4",children:[t("svg",{className:"w-5 h-5 md:w-6 md:h-6 text-theme-gold-600 inline-flex",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{marginTop:"-2px"},children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),t("h2",{className:"responsive-heading-2 text-gray-900",children:"Staff Performance"})]}),t("div",{className:"responsive-grid responsive-grid-2 lg:grid-cols-3",children:k.slice(0,6).map((i,g)=>s("div",{className:"responsive-card bg-gradient-to-br from-indigo-50 to-indigo-100 border-2 border-indigo-200",children:[s("div",{className:"flex items-center justify-between mb-3",children:[s("div",{className:"flex items-center gap-2",children:[t("div",{className:"w-8 h-8 bg-indigo-200 rounded-full flex items-center justify-center",children:s("span",{className:"text-sm font-bold text-indigo-700",children:["#",g+1]})}),s("div",{children:[t("div",{className:"text-sm font-bold text-indigo-900",children:i.staffName}),t("div",{className:"text-xs text-indigo-600",children:i.className})]})]}),s("div",{className:"text-right",children:[s("div",{className:"text-2xl font-bold text-indigo-700",children:[i.completionRate,"%"]}),t("div",{className:"text-xs text-indigo-600",children:"Complete"})]})]}),s("div",{className:"grid grid-cols-3 gap-2 text-center",children:[s("div",{children:[t("div",{className:"text-lg font-bold text-indigo-900",children:i.total}),t("div",{className:"text-xs text-indigo-600",children:"Total"})]}),s("div",{children:[t("div",{className:"text-lg font-bold text-green-600",children:i.verified}),t("div",{className:"text-xs text-indigo-600",children:"Verified"})]}),s("div",{children:[t("div",{className:"text-lg font-bold text-purple-600",children:i.dispatched}),t("div",{className:"text-xs text-indigo-600",children:"Sent"})]})]})]},i.staffId))})]}),s("div",{children:[s("div",{className:"flex items-center gap-2 mb-4",children:[t("svg",{className:"w-5 h-5 md:w-6 md:h-6 text-theme-gold-600 inline-flex",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{marginTop:"-2px"},children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),t("h2",{className:"responsive-heading-2 text-gray-900",children:"Quick Actions"})]}),s("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[s("button",{onClick:()=>window.location.href="/approval-requests",className:"responsive-card group bg-gradient-to-br from-yellow-50 to-yellow-100 border-2 border-yellow-200 hover:shadow-xl transition-all duration-300 text-left",children:[s("div",{className:"flex items-start justify-between mb-3",children:[t("div",{className:"p-3 bg-yellow-100 rounded-xl group-hover:bg-yellow-200 transition-colors",children:t("svg",{className:"w-6 h-6 md:w-7 md:h-7 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),t("span",{className:"text-xs font-semibold text-yellow-600 bg-yellow-50 px-2 py-1 rounded-full",children:(n==null?void 0:n.byStatus.pending)||0})]}),t("h3",{className:"text-base md:text-lg font-bold text-yellow-900 mb-2",children:"Pending Approvals"}),t("p",{className:"text-sm text-yellow-700",children:"Review dispatch requests awaiting approval"})]}),s("button",{onClick:()=>window.location.href="/reports",className:"responsive-card group bg-gradient-to-br from-green-50 to-green-100 border-2 border-green-200 hover:shadow-xl transition-all duration-300 text-left",children:[s("div",{className:"flex items-start justify-between mb-3",children:[t("div",{className:"p-3 bg-green-100 rounded-xl group-hover:bg-green-200 transition-colors",children:t("svg",{className:"w-6 h-6 md:w-7 md:h-7 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),t("span",{className:"text-xs font-semibold text-green-600 bg-green-50 px-2 py-1 rounded-full",children:"Reports"})]}),t("h3",{className:"text-base md:text-lg font-bold text-green-900 mb-2",children:"Export Reports"}),t("p",{className:"text-sm text-green-700",children:"Generate comprehensive department analytics"})]}),s("button",{onClick:()=>window.location.href="/records",className:"responsive-card group bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-blue-200 hover:shadow-xl transition-all duration-300 text-left",children:[s("div",{className:"flex items-start justify-between mb-3",children:[t("div",{className:"p-3 bg-blue-100 rounded-xl group-hover:bg-blue-200 transition-colors",children:t("svg",{className:"w-6 h-6 md:w-7 md:h-7 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),t("span",{className:"text-xs font-semibold text-blue-600 bg-blue-50 px-2 py-1 rounded-full",children:"All"})]}),t("h3",{className:"text-base md:text-lg font-bold text-blue-900 mb-2",children:"View All Records"}),t("p",{className:"text-sm text-blue-700",children:"Browse complete department marksheets"})]})]})]})]})})]})})})}export{B as default};
