import{u as se,j as t,a as s,F as re}from"./index-2dab8aa8.js";import{r as l,u as ne}from"./react-vendor-bd533c48.js";import{R as ae}from"./RefreshButton-b6add680.js";import{u as oe}from"./Confetti-301c7e42.js";import{H as le}from"./ContextualHelp-25dd7908.js";function ge(){const{showSuccess:d,showError:h,showWarning:q}=se(),{celebrate:b,ConfettiContainer:L}=oe(),[r,R]=l.useState(()=>{try{const e=localStorage.getItem("auth");return e?JSON.parse(e):null}catch(e){return console.error("Failed to parse auth data:",e),null}}),[w,C]=l.useState([]),[O,j]=l.useState(!0),[v,k]=l.useState("all"),[f,B]=l.useState({open:!1,type:null,marksheet:null,anchorRect:null}),[W,M]=l.useState(!1),[F,D]=l.useState(""),[Y,$]=l.useState(""),[a,A]=l.useState(!1),[J,I]=l.useState(!1),[X,G]=l.useState(!1),[U,K]=l.useState(!1),Z=ne();l.useEffect(()=>{(r==null?void 0:r.role)==="hod"?P():j(!1)},[r]);const P=async()=>{if(r){j(!0);try{console.log("[ApprovalRequests] Fetching with department:",r.department);const o=await(await fetch(`/api/marksheets?department=${r.department}&status=dispatch_requested,rescheduled_by_hod`)).json();console.log("[ApprovalRequests] Response:",o),o.success?C(o.marksheets):C([])}catch(e){console.error("Error fetching pending requests:",e),C([])}finally{j(!1)}}},z=async()=>{try{if(r!=null&&r.eSignature)return r;const e=(r==null?void 0:r._id)||(r==null?void 0:r.id);if(!e)return null;const o=await fetch(`/api/users?action=profile&userId=${e}`),n=await o.json();if(o.ok&&n.success&&n.user){const i={...r,...n.user};try{localStorage.setItem("auth",JSON.stringify(i))}catch{}return R(i),i}}catch(e){console.error("[ApprovalRequests] Failed to refresh HOD profile:",e)}return r},u=async()=>{K(!0);try{await P()}finally{K(!1)}},m=(e,o,n)=>{var g;const i=typeof window<"u",c=(g=e==null?void 0:e.currentTarget)==null?void 0:g.getBoundingClientRect(),p=c&&i?{top:c.top+window.scrollY,left:c.left+window.scrollX,width:c.width,height:c.height}:null;D(""),B({open:!0,type:n,marksheet:o,anchorRect:p})},x=()=>{B({open:!1,type:null,marksheet:null,anchorRect:null}),D("")},H=async({comments:e,scheduledDispatchDate:o})=>{var n,i;if(!(!f.marksheet||!f.type))try{M(!0);const c=await z();if(!(c!=null&&c.eSignature)){h("Signature Missing","Please add your signature in Settings before approving or rescheduling"),M(!1);return}const p=r._id||r.id,g=await fetch("/api/marksheets?action=hod-response",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({marksheetId:f.marksheet._id,hodId:p,response:f.type,comments:e,scheduledDispatchDate:o})}),_=await g.json();if(!g.ok||!_.success)throw new Error(_.error||"Failed to submit response");const S=f.type==="approved"?"approved":f.type==="rejected"?"rejected":"rescheduled",y=((i=(n=f.marksheet)==null?void 0:n.studentDetails)==null?void 0:i.name)||"Student";$(`Dispatch request ${S} successfully.`),f.type==="approved"?d("âœ“ Approved",`Dispatch approved for ${y}`):f.type==="rejected"?q("Request Rejected",`Dispatch rejected for ${y}`):d("Rescheduled",`Dispatch rescheduled for ${y}`),x(),await P()}catch(c){D(c.message||"Unexpected error"),h("Action Failed",c.message||"Could not process the request")}finally{M(!1)}},V=async e=>{const o=N.filter(n=>n.status==="dispatch_requested"||n.status==="rescheduled_by_hod");if(o.length===0){$(`No pending requests available for bulk ${e}.`);return}try{const n=await z();if(!(n!=null&&n.eSignature)){h("Signature Missing","Please add your signature in Settings before approving or rescheduling");return}A(!0),D("");const i=r._id||r.id,c=o.map(S=>fetch("/api/marksheets?action=hod-response",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({marksheetId:S._id,hodId:i,response:e,comments:"",scheduledDispatchDate:null})}).then(y=>y.json())),p=await Promise.all(c),g=p.filter(S=>S.success).length,_=p.length-g;if(g>0){const S=`Successfully ${e} ${g} request${g>1?"s":""}.${_>0?` ${_} failed.`:""}`;$(S),d(`Bulk ${e.charAt(0).toUpperCase()+e.slice(1)}`,`${g}/${p.length} requests processed successfully`),_===0&&b()}else{const S=`Failed to ${e.slice(0,-1)} any requests. Please try again.`;D(S),h("Bulk Action Failed",S)}await P()}catch(n){D(n.message||`Failed to perform bulk ${e}`)}finally{A(!1)}},E=l.useMemo(()=>[{id:"all",label:"All",count:w.length},{id:"dispatch_requested",label:"Pending",count:w.filter(e=>e.status==="dispatch_requested").length},{id:"rescheduled_by_hod",label:"Rescheduled",count:w.filter(e=>e.status==="rescheduled_by_hod").length}],[w]),N=l.useMemo(()=>(v==="all"?w:w.filter(o=>o.status===v)).sort((o,n)=>{var p,g;const i=(((p=o.studentDetails)==null?void 0:p.regNumber)||"").toString().toLowerCase(),c=(((g=n.studentDetails)==null?void 0:g.regNumber)||"").toString().toLowerCase();return i.localeCompare(c,void 0,{numeric:!0,sensitivity:"base"})}),[w,v]),ee={dispatch_requested:"bg-yellow-100 text-yellow-800",rescheduled_by_hod:"bg-orange-100 text-orange-800",approved_by_hod:"bg-green-100 text-green-800",rejected_by_hod:"bg-red-100 text-red-800",dispatched:"bg-purple-100 text-purple-800"},Q={dispatch_requested:"â³",rescheduled_by_hod:"ðŸ”„",approved_by_hod:"âœ…",rejected_by_hod:"â›”",dispatched:"ðŸ“¤"},T=(e={})=>{const o=(e.year||"").toString(),n=(e.section||"").toString();return!o&&!n?"N/A":n?o?`${o}-${n}`:n:o};return!r||r.role!=="hod"?t("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 flex items-center justify-center",children:s("div",{className:"glass-card p-8 rounded-3xl text-center",children:[t("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),t("p",{className:"text-gray-600",children:"Only HODs can approve dispatch requests."})]})}):s("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:[t("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:s("div",{className:"max-w-6xl mx-auto",children:[s("div",{className:"text-center mb-8",children:[t("h1",{className:"text-4xl sm:text-5xl lg:text-6xl font-black text-gray-900 mb-4",children:"Approval Requests"}),s("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:["Review and approve dispatch requests for ",r.department," Department"]})]}),t("div",{className:"glass-card p-4 sm:p-6 md:p-8 rounded-2xl md:rounded-3xl mb-8",children:O?s("div",{className:"text-center py-12",children:[t("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),t("p",{className:"text-gray-600",children:"Loading pending requests..."})]}):w.length===0?s("div",{className:"text-center py-12",children:[t("svg",{className:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),t("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No pending requests"}),t("p",{className:"text-gray-600",children:"All dispatch requests have been processed"})]}):s(re,{children:[t("div",{className:"flex flex-wrap items-center gap-3 mb-6",children:E.map(e=>s("button",{onClick:()=>k(e.id),className:`px-4 py-2 rounded-full text-sm font-medium border transition-all duration-200 ${v===e.id?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-200 hover:border-blue-400"}`,children:[e.label,t("span",{className:`ml-2 inline-flex items-center justify-center px-2 py-0.5 rounded-full text-xs font-semibold ${v===e.id?"bg-white/25 text-white":"bg-gray-100 text-gray-700"}`,children:e.count})]},e.id))}),Y&&t("div",{className:"mb-6 rounded-xl border border-green-200 bg-green-50 px-4 py-3 text-sm text-green-800",children:Y}),F&&t("div",{className:"mb-6 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-800",children:F}),s("div",{className:"mb-6 p-3 sm:p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100",children:[s("div",{className:"flex items-start justify-between gap-4 mb-3",children:[t("div",{className:"flex items-center gap-2",children:s("div",{children:[s("div",{className:"flex items-center gap-2",children:[t("h3",{className:"text-sm font-semibold text-gray-900",children:"Bulk Actions"}),t(le,{content:"Quickly approve, reschedule, or reject all pending dispatch requests at once."})]}),s("p",{className:"text-xs text-gray-600",children:[N.filter(e=>e.status==="dispatch_requested"||e.status==="rescheduled_by_hod").length," pending requests available"]})]})}),t(ae,{isLoading:U,onClick:u})]}),s("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3",children:[t("button",{onClick:()=>V("approved"),disabled:a||N.filter(e=>e.status==="dispatch_requested"||e.status==="rescheduled_by_hod").length===0,className:`px-3 sm:px-4 py-2 rounded-lg font-medium text-white text-xs sm:text-sm transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-1 ${a||N.filter(e=>e.status==="dispatch_requested"||e.status==="rescheduled_by_hod").length===0?"bg-gray-300 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,children:s("span",{className:"flex items-center justify-center gap-1",children:[t("span",{children:"âœ…"}),t("span",{children:a?"Processing...":"Approve All"})]})}),t("button",{onClick:()=>I(!0),disabled:a||N.filter(e=>e.status==="dispatch_requested"||e.status==="rescheduled_by_hod").length===0,className:`px-3 sm:px-4 py-2 rounded-lg font-medium text-white text-xs sm:text-sm transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-1 ${a||N.filter(e=>e.status==="dispatch_requested"||e.status==="rescheduled_by_hod").length===0?"bg-gray-300 cursor-not-allowed":"bg-orange-500 hover:bg-orange-600"}`,children:s("span",{className:"flex items-center justify-center gap-1",children:[t("span",{children:"ðŸ”„"}),t("span",{children:a?"Processing...":"Reschedule All"})]})}),t("button",{onClick:()=>V("rejected"),disabled:a||N.filter(e=>e.status==="dispatch_requested"||e.status==="rescheduled_by_hod").length===0,className:`px-3 sm:px-4 py-2 rounded-lg font-medium text-white text-xs sm:text-sm transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-1 ${a||N.filter(e=>e.status==="dispatch_requested"||e.status==="rescheduled_by_hod").length===0?"bg-gray-300 cursor-not-allowed":"bg-red-600 hover:bg-red-700"}`,children:s("span",{className:"flex items-center justify-center gap-1",children:[t("span",{children:"â›”"}),t("span",{children:a?"Processing...":"Reject All"})]})})]})]}),t("div",{className:"space-y-4",children:N.map(e=>{var o,n,i,c;return s("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[s("div",{className:"p-4 sm:p-6 pb-3 sm:pb-4",children:[s("div",{className:"flex items-start justify-between mb-3 gap-2",children:[s("div",{className:"flex-1 min-w-0",children:[t("h3",{className:"text-lg sm:text-xl font-bold text-gray-900 mb-1 truncate",children:(o=e.studentDetails)==null?void 0:o.name}),s("p",{className:"text-xs sm:text-sm text-gray-600",children:[(n=e.studentDetails)==null?void 0:n.regNumber," â€¢ ",T(e.studentDetails)]})]}),s("span",{className:`px-2 py-1 sm:px-3 sm:py-1.5 rounded-full text-xs font-semibold uppercase tracking-wide flex items-center gap-1 whitespace-nowrap ${ee[e.status]||"bg-yellow-100 text-yellow-800"}`,children:[t("span",{className:"text-xs sm:text-sm",children:Q[e.status]||"ðŸ“„"}),t("span",{className:"text-xs",children:(e.status||"").replace(/_/g," ")})]})]}),s("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 md:gap-6 text-xs sm:text-sm",children:[s("div",{children:[t("p",{className:"text-gray-500 mb-1",children:"Staff:"}),t("p",{className:"font-medium text-gray-900 truncate",children:e.staffName||"demo staff"})]}),s("div",{children:[t("p",{className:"text-gray-500 mb-1",children:"Parent Phone:"}),t("p",{className:"font-medium text-gray-900",children:((i=e.studentDetails)==null?void 0:i.parentPhoneNumber)||"â€”"})]}),s("div",{children:[t("p",{className:"text-gray-500 mb-1",children:"Exam Date:"}),t("p",{className:"font-medium text-gray-900",children:e.examinationDate?new Date(e.examinationDate).toLocaleDateString("en-US",{month:"short",year:"numeric"}):"â€”"})]}),s("div",{children:[t("p",{className:"text-gray-500 mb-1",children:"Subjects:"}),t("p",{className:"font-medium text-gray-900",children:((c=e.subjects)==null?void 0:c.length)||0})]})]})]}),t("div",{className:"border-t border-gray-100"}),t("div",{className:"p-4 sm:p-6 pt-3 sm:pt-4 bg-gray-50",children:s("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3",children:[s("button",{onClick:p=>m(p,e,"approved"),className:"px-3 sm:px-4 py-2 sm:py-2.5 bg-green-600 hover:bg-green-700 text-white text-xs sm:text-sm font-medium rounded-lg transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-1",children:[t("span",{className:"hidden sm:inline",children:"Approve Dispatch"}),t("span",{className:"sm:hidden",children:"Approve"})]}),s("button",{onClick:p=>m(p,e,"rejected"),className:"px-3 sm:px-4 py-2 sm:py-2.5 bg-red-600 hover:bg-red-700 text-white text-xs sm:text-sm font-medium rounded-lg transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-1",children:[t("span",{className:"hidden sm:inline",children:"Reject Request"}),t("span",{className:"sm:hidden",children:"Reject"})]}),t("button",{onClick:p=>m(p,e,"rescheduled"),className:"px-3 sm:px-4 py-2 sm:py-2.5 bg-yellow-500 hover:bg-yellow-600 text-white text-xs sm:text-sm font-medium rounded-lg transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-1",children:"Reschedule"}),s("button",{onClick:()=>Z(`/marksheets/${e._id||e.marksheetId}`),className:"px-3 sm:px-4 py-2 sm:py-2.5 bg-white hover:bg-gray-50 text-gray-700 text-xs sm:text-sm font-medium rounded-lg border border-gray-300 transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-1",children:[t("span",{className:"hidden sm:inline",children:"View Details"}),t("span",{className:"sm:hidden",children:"Details"})]})]})}),t("div",{className:"my-6 border-t border-dashed border-gray-300"})]},e._id)})})]})})]})}),t(ie,{open:f.open,type:f.type,marksheet:f.marksheet,anchorRect:f.anchorRect,onClose:x,onSubmit:H,loading:W,error:F}),t(de,{open:J,onClose:()=>I(!1),loading:X,onSubmit:async({comments:e,scheduledDispatchDate:o})=>{const n=N.filter(i=>i.status==="dispatch_requested"||i.status==="rescheduled_by_hod");if(n.length===0){$("No pending requests to reschedule."),I(!1);return}try{const i=await z();if(!(i!=null&&i.eSignature)){h("Signature Missing","Please add your signature in Settings before approving or rescheduling"),I(!1);return}G(!0);const c=r._id||r.id,p=n.map(y=>fetch("/api/marksheets?action=hod-response",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({marksheetId:y._id,hodId:c,response:"rescheduled",comments:e||"",scheduledDispatchDate:o||null})}).then(te=>te.json()).catch(te=>({success:!1,error:te.message}))),g=await Promise.all(p),_=g.filter(y=>y&&y.success).length,S=g.length-_;if(_>0){const y=`Rescheduled ${_} request${_>1?"s":""}.${S>0?` ${S} failed.`:""}`;$(y),d("Bulk Reschedule",`${_}/${g.length} requests rescheduled`)}else{const y="Failed to reschedule any requests. Please try again.";D(y),h("Bulk Reschedule Failed",y)}await P()}catch(i){D(i.message||"Bulk reschedule failed")}finally{G(!1),I(!1)}}}),t(L,{})]})}function ie({open:d,type:h,marksheet:q,anchorRect:b,onClose:L,onSubmit:r,loading:R,error:w}){var P,z;const[C,O]=l.useState(""),[j,v]=l.useState(""),[k,f]=l.useState(()=>typeof window<"u"?window.innerWidth<640:!0),[B,W]=l.useState(d);if(l.useEffect(()=>{const u=()=>f(window.innerWidth<640);return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]),l.useEffect(()=>{if(d)W(!0);else{const u=setTimeout(()=>W(!1),120);return()=>clearTimeout(u)}},[d]),l.useEffect(()=>{var u;if(!(!d||!q))if(O(""),(u=q.dispatchRequest)!=null&&u.scheduledDispatchDate){const m=new Date(q.dispatchRequest.scheduledDispatchDate);Number.isNaN(m.getTime())?v(""):v(m.toISOString().slice(0,16))}else v("")},[d,h,q]),!B||!q)return null;const M=h==="rescheduled",F=h==="approved"?"Approve dispatch request":h==="rejected"?"Reject dispatch request":"Reschedule dispatch request",D=u=>{u.preventDefault();const m={comments:C.trim()||void 0,scheduledDispatchDate:void 0};if(j){const x=new Date(j);Number.isNaN(x.getTime())||(m.scheduledDispatchDate=x.toISOString())}try{a(!0)}catch{}r(m)},$=(()=>{if(typeof window>"u")return{width:"100%",maxWidth:"100%",borderRadius:"24px 24px 0 0",position:"fixed",left:0,right:0,bottom:0,margin:"0 auto"};if(["rejected","rescheduled","approved"].includes(h)){const T=Math.min(420,window.innerWidth-32),e=window.innerWidth,o=Math.max(16,Math.min((e-T)/2,e-T-16)),n=Math.max(window.scrollY+16,window.scrollY+80);return{width:T,position:"absolute",left:o,top:n}}if(k||!b)return{width:"100%",maxWidth:"100%",borderRadius:"24px 24px 0 0",position:"fixed",left:0,right:0,bottom:0,margin:"0 auto"};const m=16,x=420,H=window.innerWidth,V=window.innerHeight;if(h==="rejected"||h==="rescheduled"||h==="approved"){const Q=Math.max(m,Math.min((H-x)/2,H-x-m)),T=Math.max(window.scrollY+m,window.scrollY+120);return{width:x,position:"absolute",left:Q,top:T}}let E=b.left+b.width+12;E+x>H-m&&(E=b.left-x-12,E<m&&(E=Math.min(Math.max(m,b.left+b.width/2-x/2),H-x-m)));let N=b.top+b.height+12;const ee=window.scrollY+V-24-380;return N>ee&&(N=Math.max(window.scrollY+m,b.top-380-12)),{width:x,position:"absolute",left:E,top:N}})(),a=(u=!1)=>{u&&W(!1);try{L()}catch{}},A=d?"opacity-100":"opacity-0",J=d?"":"pointer-events-none",I="glass-card w-full p-6 shadow-2xl transition-all duration-100",X=d?"translate-y-0 rounded-t-2xl":"translate-y-full rounded-t-2xl",G=d?"translate-y-0 scale-100":"translate-y-2 scale-95",U=["rejected","rescheduled","approved"].includes(h),Z=`${I} ${k&&U?"rounded-xl shadow-lg":""} ${U?G:k?X:G}`;return t("div",{className:`fixed inset-0 z-50 flex items-start justify-center bg-black/40 px-4 py-6 sm:py-10 ${A} ${J}`,onClick:u=>{u.target===u.currentTarget&&a(!1)},style:{transition:"opacity 100ms cubic-bezier(0.2,0,0,1)"},children:s("div",{className:Z,style:$,children:[s("div",{className:"mb-4",children:[t("h3",{className:"text-xl font-semibold text-gray-900",children:F}),s("p",{className:"text-sm text-gray-600 mt-1",children:[(P=q.studentDetails)==null?void 0:P.name," â€¢ ",(z=q.studentDetails)==null?void 0:z.regNumber]})]}),s("form",{onSubmit:D,className:"space-y-4",children:[s("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Comments (optional)"}),t("textarea",{value:C,onChange:u=>O(u.target.value),rows:4,className:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:outline-none",placeholder:h==="rejected"?"Let the staff know the reason for rejection":"Add any notes for the staff member"})]}),s("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Schedule (optional)"}),t("input",{type:"datetime-local",value:j,onChange:u=>v(u.target.value),required:M,className:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:outline-none"}),M&&t("p",{className:"text-xs text-gray-500 mt-2",children:"Provide the new date/time for dispatch. This will be visible to the staff member."})]}),w&&t("div",{className:"rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:w}),s("div",{className:`flex ${k?"flex-col-reverse gap-2":"justify-end gap-3"} pt-2`,children:[t("button",{type:"button",onClick:()=>a(!0),className:`px-4 py-2 rounded-lg border border-gray-200 text-gray-700 hover:bg-gray-100 ${k?"w-full text-center":""}`,children:"Cancel"}),t("button",{type:"submit",disabled:R,className:`px-5 py-2 rounded-lg text-white ${R?"bg-blue-300 cursor-wait":"bg-blue-600 hover:bg-blue-700"} ${k?"w-full text-center":""}`,children:R?"Saving...":"Confirm"})]})]})]})})}function de({open:d,onClose:h,onSubmit:q,loading:b}){const[L,r]=l.useState(""),[R,w]=l.useState(""),[C,O]=l.useState(()=>typeof window<"u"?window.innerWidth<640:!0),[j,v]=l.useState(d);if(l.useEffect(()=>{const a=()=>O(window.innerWidth<640);return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),l.useEffect(()=>{if(d)v(!0);else{const a=setTimeout(()=>v(!1),120);return()=>clearTimeout(a)}},[d]),l.useEffect(()=>{d||(r(""),w(""))},[d]),!j)return null;const k=a=>{if(a.preventDefault(),!R)return;const A=new Date(R);if(!Number.isNaN(A.getTime())){try{$(!0)}catch{}q({comments:L.trim(),scheduledDispatchDate:A.toISOString()})}},f=d?"opacity-100":"opacity-0",B=d?"":"pointer-events-none",D=`glass-card w-full max-w-md p-6 shadow-2xl transition-all duration-100 ${C?"rounded-xl shadow-lg":""} ${d?"translate-y-0 scale-100":"translate-y-2 scale-95"}`,Y={position:"absolute",top:window.scrollY+120},$=(a=!1)=>{a&&v(!1);try{h()}catch{}};return t("div",{className:`fixed inset-0 z-50 flex items-start justify-center bg-black/40 px-4 py-6 sm:py-10 ${f} ${B}`,onClick:a=>{a.target===a.currentTarget&&$(!1)},style:{transition:"opacity 100ms cubic-bezier(0.2,0,0,1)"},children:s("div",{className:D,style:Y,children:[s("div",{className:"mb-4",children:[t("h3",{className:"text-xl font-semibold text-gray-900",children:"Reschedule all pending requests"}),t("p",{className:"text-sm text-gray-600 mt-1",children:"Provide a new schedule date/time and optional comments for all pending requests."})]}),s("form",{onSubmit:k,className:"space-y-4",children:[s("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Comments (optional)"}),t("textarea",{value:L,onChange:a=>r(a.target.value),rows:3,className:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:outline-none",placeholder:"Notes for the staff members"})]}),s("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Schedule (required)"}),t("input",{type:"datetime-local",value:R,onChange:a=>w(a.target.value),required:!0,className:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:outline-none"}),t("p",{className:"text-xs text-gray-500 mt-2",children:"This date/time will be applied to all selected requests."})]}),s("div",{className:`flex ${C?"flex-col-reverse gap-2":"justify-end gap-3"} pt-2`,children:[t("button",{type:"button",onClick:()=>$(!0),className:`px-4 py-2 rounded-lg border border-gray-200 text-gray-700 hover:bg-gray-100 ${C?"w-full text-center":""}`,children:"Cancel"}),t("button",{type:"submit",disabled:b,className:`px-5 py-2 rounded-lg text-white ${b?"bg-blue-300 cursor-wait":"bg-blue-600 hover:bg-blue-700"} ${C?"w-full text-center":""}`,children:b?"Rescheduling...":"Confirm"})]})]})]})})}export{ge as default};
