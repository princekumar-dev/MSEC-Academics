import{u as ce,j as t,a as s,F as ue}from"./index-9210ed4b.js";import{r as i,u as he}from"./react-vendor-9a2eb766.js";import{R as me}from"./RefreshButton-5c4fe9ac.js";import{u as pe,a as ge,P as fe}from"./usePullToRefresh-300a5212.js";import{H as be}from"./ContextualHelp-38bf7e41.js";function _e(){const{showSuccess:o,showError:m,showWarning:_}=ce(),{celebrate:b,ConfettiContainer:L}=pe(),[r,A]=i.useState(()=>{try{const e=localStorage.getItem("auth");return e?JSON.parse(e):null}catch(e){return console.error("Failed to parse auth data:",e),null}}),[N,C]=i.useState([]),[O,j]=i.useState(!0),[v,R]=i.useState("all"),[g,B]=i.useState({open:!1,type:null,marksheet:null,anchorRect:null}),[H,P]=i.useState(!1),[W,D]=i.useState(""),[z,q]=i.useState(""),[a,I]=i.useState(!1),[U,M]=i.useState(!1),[ee,Y]=i.useState(!1),[V,te]=i.useState(!1),se={AI_DS:"AI & DS",CSE:"CSE",IT:"IT",ECE:"ECE",EEE:"EEE",MECH:"MECH",CIVIL:"CIVIL",HNS:"H&S"},Q={CSE:"bg-blue-100 text-blue-800",AI_DS:"bg-indigo-100 text-indigo-800",ECE:"bg-teal-100 text-teal-800",IT:"bg-green-100 text-green-800",MECH:"bg-amber-100 text-amber-800",CIVIL:"bg-red-100 text-red-800",EEE:"bg-purple-100 text-purple-800",HNS:"bg-yellow-50 text-yellow-800"},X=he(),u=async()=>{await $(),o("ðŸ”„ Refreshed","Approval requests updated")},{isPulling:f,isRefreshing:S,pullDistance:F,containerRef:re,threshold:T}=ge(u,{enabled:!0,threshold:80});i.useEffect(()=>{(r==null?void 0:r.role)==="hod"?$():j(!1)},[r]);const $=async()=>{if(r){j(!0);try{if(r.department==="HNS"){console.log("[ApprovalRequests] HNS HOD detected â€” fetching Year I pending requests across departments");var e=await fetch("/api/marksheets?year=I&status=dispatch_requested,rescheduled_by_hod")}else{console.log("[ApprovalRequests] Fetching with department:",r.department);var e=await fetch(`/api/marksheets?department=${r.department}&status=dispatch_requested,rescheduled_by_hod`)}const l=await e.json();console.log("[ApprovalRequests] Response:",l),l.success?C(l.marksheets):C([])}catch(l){console.error("Error fetching pending requests:",l),C([])}finally{j(!1)}}},G=async()=>{try{if(r!=null&&r.eSignature)return r;const e=(r==null?void 0:r._id)||(r==null?void 0:r.id);if(!e)return null;const l=await fetch(`/api/users?action=profile&userId=${e}`),n=await l.json();if(l.ok&&n.success&&n.user){const d={...r,...n.user};try{localStorage.setItem("auth",JSON.stringify(d))}catch{}return A(d),d}}catch(e){console.error("[ApprovalRequests] Failed to refresh HOD profile:",e)}return r},K=async()=>{te(!0);try{await $()}finally{te(!1)}},E=(e,l,n)=>{var h;const d=typeof window<"u",c=(h=e==null?void 0:e.currentTarget)==null?void 0:h.getBoundingClientRect(),x=c&&d?{top:c.top+window.scrollY,left:c.left+window.scrollX,width:c.width,height:c.height}:null;D(""),B({open:!0,type:n,marksheet:l,anchorRect:x})},J=()=>{B({open:!1,type:null,marksheet:null,anchorRect:null}),D("")},ne=async({comments:e,scheduledDispatchDate:l})=>{var n,d;if(!(!g.marksheet||!g.type))try{P(!0);const c=await G();if(!(c!=null&&c.eSignature)){m("Signature Missing","Please add your signature in Settings before approving or rescheduling"),P(!1);return}const x=r._id||r.id,h=await fetch("/api/marksheets?action=hod-response",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({marksheetId:g.marksheet._id,hodId:x,response:g.type,comments:e,scheduledDispatchDate:l})}),y=await h.json();if(!h.ok||!y.success)throw new Error(y.error||"Failed to submit response");const p=g.type==="approved"?"approved":g.type==="rejected"?"rejected":"rescheduled",w=((d=(n=g.marksheet)==null?void 0:n.studentDetails)==null?void 0:d.name)||"Student";q(`Dispatch request ${p} successfully.`),g.type==="approved"?o("âœ“ Approved",`Dispatch approved for ${w}`):g.type==="rejected"?_("Request Rejected",`Dispatch rejected for ${w}`):o("Rescheduled",`Dispatch rescheduled for ${w}`),J(),await $()}catch(c){D(c.message||"Unexpected error"),m("Action Failed",c.message||"Could not process the request")}finally{P(!1)}},Z=async e=>{const l=k.filter(n=>n.status==="dispatch_requested"||n.status==="rescheduled_by_hod");if(l.length===0){q(`No pending requests available for bulk ${e}.`);return}try{const n=await G();if(!(n!=null&&n.eSignature)){m("Signature Missing","Please add your signature in Settings before approving or rescheduling");return}I(!0),D("");const d=r._id||r.id,c=l.map(p=>fetch("/api/marksheets?action=hod-response",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({marksheetId:p._id,hodId:d,response:e,comments:"",scheduledDispatchDate:null})}).then(w=>w.json())),x=await Promise.all(c),h=x.filter(p=>p.success).length,y=x.length-h;if(h>0){const p=`Successfully ${e} ${h} request${h>1?"s":""}.${y>0?` ${y} failed.`:""}`;q(p),o(`Bulk ${e.charAt(0).toUpperCase()+e.slice(1)}`,`${h}/${x.length} requests processed successfully`),y===0&&b()}else{const p=`Failed to ${e.slice(0,-1)} any requests. Please try again.`;D(p),m("Bulk Action Failed",p)}await $()}catch(n){D(n.message||`Failed to perform bulk ${e}`)}finally{I(!1)}},le=i.useMemo(()=>[{id:"all",label:"All",count:N.length},{id:"dispatch_requested",label:"Pending",count:N.filter(e=>e.status==="dispatch_requested").length},{id:"rescheduled_by_hod",label:"Rescheduled",count:N.filter(e=>e.status==="rescheduled_by_hod").length}],[N]),k=i.useMemo(()=>(v==="all"?N:N.filter(l=>l.status===v)).sort((l,n)=>{var x,h;const d=(((x=l.studentDetails)==null?void 0:x.regNumber)||"").toString().toLowerCase(),c=(((h=n.studentDetails)==null?void 0:h.regNumber)||"").toString().toLowerCase();return d.localeCompare(c,void 0,{numeric:!0,sensitivity:"base"})}),[N,v]),ie={dispatch_requested:"bg-yellow-100 text-yellow-800",rescheduled_by_hod:"bg-orange-100 text-orange-800",approved_by_hod:"bg-green-100 text-green-800",rejected_by_hod:"bg-red-100 text-red-800",dispatched:"bg-purple-100 text-purple-800"},oe={dispatch_requested:"â³",rescheduled_by_hod:"ðŸ”„",approved_by_hod:"âœ…",rejected_by_hod:"â›”",dispatched:"ðŸ“¤"},de=(e={})=>{const l=(e.year||"").toString(),n=(e.section||"").toString();return!l&&!n?"N/A":n?l?`${l}-${n}`:n:l};return!r||r.role!=="hod"?t("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 flex items-center justify-center",children:s("div",{className:"glass-card p-8 rounded-3xl text-center",children:[t("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),t("p",{className:"text-gray-600",children:"Only HODs can approve dispatch requests."})]})}):s("div",{ref:re,className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:[t(fe,{pullDistance:F,threshold:T,isRefreshing:S}),t("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:s("div",{className:"max-w-6xl mx-auto",children:[s("div",{className:"text-center mb-8",children:[t("h1",{className:"text-4xl sm:text-5xl lg:text-6xl font-black text-gray-900 mb-4",children:"Approval Requests"}),s("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:["Review and approve dispatch requests for ",r.department," Department"]})]}),t("div",{className:"glass-card p-4 sm:p-6 md:p-8 rounded-2xl md:rounded-3xl mb-8",children:O?s("div",{className:"text-center py-12",children:[t("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),t("p",{className:"text-gray-600",children:"Loading pending requests..."})]}):N.length===0?s("div",{className:"text-center py-12",children:[t("svg",{className:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),t("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No pending requests"}),t("p",{className:"text-gray-600",children:"All dispatch requests have been processed"})]}):s(ue,{children:[t("div",{className:"flex flex-wrap items-center gap-3 mb-6",children:le.map(e=>s("button",{onClick:()=>R(e.id),className:`px-4 py-2 rounded-full text-sm font-medium border transition-all duration-200 ${v===e.id?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-200 hover:border-blue-400"}`,children:[e.label,t("span",{className:`ml-2 inline-flex items-center justify-center px-2 py-0.5 rounded-full text-xs font-semibold ${v===e.id?"bg-white/25 text-white":"bg-gray-100 text-gray-700"}`,children:e.count})]},e.id))}),z&&t("div",{className:"mb-6 rounded-xl border border-green-200 bg-green-50 px-4 py-3 text-sm text-green-800",children:z}),W&&t("div",{className:"mb-6 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-800",children:W}),s("div",{className:"mb-6 p-3 sm:p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100",children:[s("div",{className:"flex items-start justify-between gap-4 mb-3",children:[t("div",{className:"flex items-center gap-2",children:s("div",{children:[s("div",{className:"flex items-center gap-2",children:[t("h3",{className:"text-sm font-semibold text-gray-900",children:"Bulk Actions"}),t(be,{content:"Quickly approve, reschedule, or reject all pending dispatch requests at once."})]}),s("p",{className:"text-xs text-gray-600",children:[k.filter(e=>e.status==="dispatch_requested"||e.status==="rescheduled_by_hod").length," pending requests available"]})]})}),t(me,{isLoading:V,onClick:K})]}),s("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3",children:[t("button",{onClick:()=>Z("approved"),disabled:a||k.filter(e=>e.status==="dispatch_requested"||e.status==="rescheduled_by_hod").length===0,className:`px-3 sm:px-4 py-2 rounded-lg font-medium text-white text-xs sm:text-sm transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-1 ${a||k.filter(e=>e.status==="dispatch_requested"||e.status==="rescheduled_by_hod").length===0?"bg-gray-300 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,children:s("span",{className:"flex items-center justify-center gap-1",children:[t("span",{children:"âœ…"}),t("span",{children:a?"Processing...":"Approve All"})]})}),t("button",{onClick:()=>M(!0),disabled:a||k.filter(e=>e.status==="dispatch_requested"||e.status==="rescheduled_by_hod").length===0,className:`px-3 sm:px-4 py-2 rounded-lg font-medium text-white text-xs sm:text-sm transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-1 ${a||k.filter(e=>e.status==="dispatch_requested"||e.status==="rescheduled_by_hod").length===0?"bg-gray-300 cursor-not-allowed":"bg-orange-500 hover:bg-orange-600"}`,children:s("span",{className:"flex items-center justify-center gap-1",children:[t("span",{children:"ðŸ”„"}),t("span",{children:a?"Processing...":"Reschedule All"})]})}),t("button",{onClick:()=>Z("rejected"),disabled:a||k.filter(e=>e.status==="dispatch_requested"||e.status==="rescheduled_by_hod").length===0,className:`px-3 sm:px-4 py-2 rounded-lg font-medium text-white text-xs sm:text-sm transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-1 ${a||k.filter(e=>e.status==="dispatch_requested"||e.status==="rescheduled_by_hod").length===0?"bg-gray-300 cursor-not-allowed":"bg-red-600 hover:bg-red-700"}`,children:s("span",{className:"flex items-center justify-center gap-1",children:[t("span",{children:"â›”"}),t("span",{children:a?"Processing...":"Reject All"})]})})]})]}),t("div",{className:"space-y-4",children:k.map(e=>{var l,n,d,c,x,h,y;return s("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[s("div",{className:"p-4 sm:p-6 pb-3 sm:pb-4",children:[s("div",{className:"flex items-start justify-between mb-3 gap-2",children:[s("div",{className:"flex-1 min-w-0",children:[t("h3",{className:"text-lg sm:text-xl font-bold text-gray-900 mb-1 truncate",children:(l=e.studentDetails)==null?void 0:l.name}),s("p",{className:"text-xs sm:text-sm text-gray-600 flex items-center gap-2",children:[s("span",{children:[(n=e.studentDetails)==null?void 0:n.regNumber," â€¢ ",de(e.studentDetails)]}),((d=e.studentDetails)==null?void 0:d.department)&&t("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[10px] font-semibold uppercase ${Q[e.studentDetails.department]||"bg-gray-100 text-gray-800"}`,children:se[(c=e.studentDetails)==null?void 0:c.department]||(((x=e.studentDetails)==null?void 0:x.department)||"").toUpperCase()})]})]}),s("span",{className:`px-2 py-1 sm:px-3 sm:py-1.5 rounded-full text-xs font-semibold uppercase tracking-wide flex items-center gap-1 whitespace-nowrap ${ie[e.status]||"bg-yellow-100 text-yellow-800"}`,children:[t("span",{className:"text-xs sm:text-sm",children:oe[e.status]||"ðŸ“„"}),t("span",{className:"text-xs",children:(e.status||"").replace(/_/g," ")})]})]}),s("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 md:gap-6 text-xs sm:text-sm",children:[s("div",{children:[t("p",{className:"text-gray-500 mb-1",children:"Staff:"}),t("p",{className:"font-medium text-gray-900 truncate",children:e.staffName||"demo staff"})]}),s("div",{children:[t("p",{className:"text-gray-500 mb-1",children:"Parent Phone:"}),t("p",{className:"font-medium text-gray-900",children:((h=e.studentDetails)==null?void 0:h.parentPhoneNumber)||"â€”"})]}),s("div",{children:[t("p",{className:"text-gray-500 mb-1",children:"Exam Date:"}),t("p",{className:"font-medium text-gray-900",children:e.examinationDate?new Date(e.examinationDate).toLocaleDateString("en-US",{month:"short",year:"numeric"}):"â€”"})]}),s("div",{children:[t("p",{className:"text-gray-500 mb-1",children:"Subjects:"}),t("p",{className:"font-medium text-gray-900",children:((y=e.subjects)==null?void 0:y.length)||0})]})]})]}),t("div",{className:"border-t border-gray-100"}),t("div",{className:"p-4 sm:p-6 pt-3 sm:pt-4 bg-gray-50",children:s("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3",children:[s("button",{onClick:p=>E(p,e,"approved"),className:"px-3 sm:px-4 py-2 sm:py-2.5 bg-green-600 hover:bg-green-700 text-white text-xs sm:text-sm font-medium rounded-lg transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-1",children:[t("span",{className:"hidden sm:inline",children:"Approve Dispatch"}),t("span",{className:"sm:hidden",children:"Approve"})]}),s("button",{onClick:p=>E(p,e,"rejected"),className:"px-3 sm:px-4 py-2 sm:py-2.5 bg-red-600 hover:bg-red-700 text-white text-xs sm:text-sm font-medium rounded-lg transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-1",children:[t("span",{className:"hidden sm:inline",children:"Reject Request"}),t("span",{className:"sm:hidden",children:"Reject"})]}),t("button",{onClick:p=>E(p,e,"rescheduled"),className:"px-3 sm:px-4 py-2 sm:py-2.5 bg-yellow-500 hover:bg-yellow-600 text-white text-xs sm:text-sm font-medium rounded-lg transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-1",children:"Reschedule"}),s("button",{onClick:()=>X(`/marksheets/${e._id||e.marksheetId}`),className:"px-3 sm:px-4 py-2 sm:py-2.5 bg-white hover:bg-gray-50 text-gray-700 text-xs sm:text-sm font-medium rounded-lg border border-gray-300 transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-1",children:[t("span",{className:"hidden sm:inline",children:"View Details"}),t("span",{className:"sm:hidden",children:"Details"})]})]})}),t("div",{className:"my-6 border-t border-dashed border-gray-300"})]},e._id)})})]})})]})}),t(xe,{open:g.open,type:g.type,marksheet:g.marksheet,anchorRect:g.anchorRect,onClose:J,onSubmit:ne,loading:H,error:W}),t(ye,{open:U,onClose:()=>M(!1),loading:ee,onSubmit:async({comments:e,scheduledDispatchDate:l})=>{const n=k.filter(d=>d.status==="dispatch_requested"||d.status==="rescheduled_by_hod");if(n.length===0){q("No pending requests to reschedule."),M(!1);return}try{const d=await G();if(!(d!=null&&d.eSignature)){m("Signature Missing","Please add your signature in Settings before approving or rescheduling"),M(!1);return}Y(!0);const c=r._id||r.id,x=n.map(w=>fetch("/api/marksheets?action=hod-response",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({marksheetId:w._id,hodId:c,response:"rescheduled",comments:e||"",scheduledDispatchDate:l||null})}).then(ae=>ae.json()).catch(ae=>({success:!1,error:ae.message}))),h=await Promise.all(x),y=h.filter(w=>w&&w.success).length,p=h.length-y;if(y>0){const w=`Rescheduled ${y} request${y>1?"s":""}.${p>0?` ${p} failed.`:""}`;q(w),o("Bulk Reschedule",`${y}/${h.length} requests rescheduled`)}else{const w="Failed to reschedule any requests. Please try again.";D(w),m("Bulk Reschedule Failed",w)}await $()}catch(d){D(d.message||"Bulk reschedule failed")}finally{Y(!1),M(!1)}}}),t(L,{})]})}function xe({open:o,type:m,marksheet:_,anchorRect:b,onClose:L,onSubmit:r,loading:A,error:N}){var Q,X;const[C,O]=i.useState(""),[j,v]=i.useState(""),[R,g]=i.useState(()=>typeof window<"u"?window.innerWidth<640:!0),[B,H]=i.useState(o);if(i.useEffect(()=>{const u=()=>g(window.innerWidth<640);return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]),i.useEffect(()=>{if(o)H(!0);else{const u=setTimeout(()=>H(!1),120);return()=>clearTimeout(u)}},[o]),i.useEffect(()=>{var u;if(!(!o||!_))if(O(""),(u=_.dispatchRequest)!=null&&u.scheduledDispatchDate){const f=new Date(_.dispatchRequest.scheduledDispatchDate);Number.isNaN(f.getTime())?v(""):v(f.toISOString().slice(0,16))}else v("")},[o,m,_]),!B||!_)return null;const P=m==="rescheduled",W=m==="approved"?"Approve dispatch request":m==="rejected"?"Reject dispatch request":"Reschedule dispatch request",D=u=>{u.preventDefault();const f={comments:C.trim()||void 0,scheduledDispatchDate:void 0};if(j){const S=new Date(j);Number.isNaN(S.getTime())||(f.scheduledDispatchDate=S.toISOString())}try{a(!0)}catch{}r(f)},q=(()=>{if(typeof window>"u")return{width:"100%",maxWidth:"100%",borderRadius:"24px 24px 0 0",position:"fixed",left:0,right:0,bottom:0,margin:"0 auto"};if(["rejected","rescheduled","approved"].includes(m)){const E=Math.min(420,window.innerWidth-32),J=window.innerWidth,ne=Math.max(16,Math.min((J-E)/2,J-E-16)),Z=Math.max(window.scrollY+16,window.scrollY+80);return{width:E,position:"absolute",left:ne,top:Z}}if(R||!b)return{width:"100%",maxWidth:"100%",borderRadius:"24px 24px 0 0",position:"fixed",left:0,right:0,bottom:0,margin:"0 auto"};const f=16,S=420,F=window.innerWidth,re=window.innerHeight;if(m==="rejected"||m==="rescheduled"||m==="approved"){const K=Math.max(f,Math.min((F-S)/2,F-S-f)),E=Math.max(window.scrollY+f,window.scrollY+120);return{width:S,position:"absolute",left:K,top:E}}let T=b.left+b.width+12;T+S>F-f&&(T=b.left-S-12,T<f&&(T=Math.min(Math.max(f,b.left+b.width/2-S/2),F-S-f)));let $=b.top+b.height+12;const G=window.scrollY+re-24-380;return $>G&&($=Math.max(window.scrollY+f,b.top-380-12)),{width:S,position:"absolute",left:T,top:$}})(),a=(u=!1)=>{u&&H(!1);try{L()}catch{}},I=o?"opacity-100":"opacity-0",U=o?"":"pointer-events-none",M="glass-card w-full p-6 shadow-2xl transition-all duration-100",ee=o?"translate-y-0 rounded-t-2xl":"translate-y-full rounded-t-2xl",Y=o?"translate-y-0 scale-100":"translate-y-2 scale-95",V=["rejected","rescheduled","approved"].includes(m),se=`${M} ${R&&V?"rounded-xl shadow-lg":""} ${V?Y:R?ee:Y}`;return t("div",{className:`fixed inset-0 z-50 flex items-start justify-center bg-black/40 px-4 py-6 sm:py-10 ${I} ${U}`,onClick:u=>{u.target===u.currentTarget&&a(!1)},style:{transition:"opacity 100ms cubic-bezier(0.2,0,0,1)"},children:s("div",{className:se,style:q,children:[s("div",{className:"mb-4",children:[t("h3",{className:"text-xl font-semibold text-gray-900",children:W}),s("p",{className:"text-sm text-gray-600 mt-1",children:[(Q=_.studentDetails)==null?void 0:Q.name," â€¢ ",(X=_.studentDetails)==null?void 0:X.regNumber]})]}),s("form",{onSubmit:D,className:"space-y-4",children:[s("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Comments (optional)"}),t("textarea",{value:C,onChange:u=>O(u.target.value),rows:4,className:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:outline-none",placeholder:m==="rejected"?"Let the staff know the reason for rejection":"Add any notes for the staff member"})]}),s("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Schedule (optional)"}),t("input",{type:"datetime-local",value:j,onChange:u=>v(u.target.value),required:P,className:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:outline-none"}),P&&t("p",{className:"text-xs text-gray-500 mt-2",children:"Provide the new date/time for dispatch. This will be visible to the staff member."})]}),N&&t("div",{className:"rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:N}),s("div",{className:`flex ${R?"flex-col-reverse gap-2":"justify-end gap-3"} pt-2`,children:[t("button",{type:"button",onClick:()=>a(!0),className:`px-4 py-2 rounded-lg border border-gray-200 text-gray-700 hover:bg-gray-100 ${R?"w-full text-center":""}`,children:"Cancel"}),t("button",{type:"submit",disabled:A,className:`px-5 py-2 rounded-lg text-white ${A?"bg-blue-300 cursor-wait":"bg-blue-600 hover:bg-blue-700"} ${R?"w-full text-center":""}`,children:A?"Saving...":"Confirm"})]})]})]})})}function ye({open:o,onClose:m,onSubmit:_,loading:b}){const[L,r]=i.useState(""),[A,N]=i.useState(""),[C,O]=i.useState(()=>typeof window<"u"?window.innerWidth<640:!0),[j,v]=i.useState(o);if(i.useEffect(()=>{const a=()=>O(window.innerWidth<640);return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),i.useEffect(()=>{if(o)v(!0);else{const a=setTimeout(()=>v(!1),120);return()=>clearTimeout(a)}},[o]),i.useEffect(()=>{o||(r(""),N(""))},[o]),!j)return null;const R=a=>{if(a.preventDefault(),!A)return;const I=new Date(A);if(!Number.isNaN(I.getTime())){try{q(!0)}catch{}_({comments:L.trim(),scheduledDispatchDate:I.toISOString()})}},g=o?"opacity-100":"opacity-0",B=o?"":"pointer-events-none",D=`glass-card w-full max-w-md p-6 shadow-2xl transition-all duration-100 ${C?"rounded-xl shadow-lg":""} ${o?"translate-y-0 scale-100":"translate-y-2 scale-95"}`,z={position:"absolute",top:window.scrollY+120},q=(a=!1)=>{a&&v(!1);try{m()}catch{}};return t("div",{className:`fixed inset-0 z-50 flex items-start justify-center bg-black/40 px-4 py-6 sm:py-10 ${g} ${B}`,onClick:a=>{a.target===a.currentTarget&&q(!1)},style:{transition:"opacity 100ms cubic-bezier(0.2,0,0,1)"},children:s("div",{className:D,style:z,children:[s("div",{className:"mb-4",children:[t("h3",{className:"text-xl font-semibold text-gray-900",children:"Reschedule all pending requests"}),t("p",{className:"text-sm text-gray-600 mt-1",children:"Provide a new schedule date/time and optional comments for all pending requests."})]}),s("form",{onSubmit:R,className:"space-y-4",children:[s("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Comments (optional)"}),t("textarea",{value:L,onChange:a=>r(a.target.value),rows:3,className:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:outline-none",placeholder:"Notes for the staff members"})]}),s("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Schedule (required)"}),t("input",{type:"datetime-local",value:A,onChange:a=>N(a.target.value),required:!0,className:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:outline-none"}),t("p",{className:"text-xs text-gray-500 mt-2",children:"This date/time will be applied to all selected requests."})]}),s("div",{className:`flex ${C?"flex-col-reverse gap-2":"justify-end gap-3"} pt-2`,children:[t("button",{type:"button",onClick:()=>q(!0),className:`px-4 py-2 rounded-lg border border-gray-200 text-gray-700 hover:bg-gray-100 ${C?"w-full text-center":""}`,children:"Cancel"}),t("button",{type:"submit",disabled:b,className:`px-5 py-2 rounded-lg text-white ${b?"bg-blue-300 cursor-wait":"bg-blue-600 hover:bg-blue-700"} ${C?"w-full text-center":""}`,children:b?"Rescheduling...":"Confirm"})]})]})]})})}export{_e as default};
