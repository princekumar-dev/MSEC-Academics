import{j as e,a}from"./index-6278ea70.js";import{r as o}from"./react-vendor-bd533c48.js";function k(){const[l,y]=o.useState(()=>{const t=localStorage.getItem("auth");return t?JSON.parse(t):null}),[r,x]=o.useState(null),[n,d]=o.useState(!1),[c,g]=o.useState(""),[p,u]=o.useState(null),[h,i]=o.useState([]),b=t=>{t.target.files&&t.target.files[0]&&x(t.target.files[0])},f=async()=>{if(r){d(!0),i([]),u(null);try{const t=new FormData;t.append("excelFile",r),t.append("staffId",l.id),t.append("examinationDate",new Date().toISOString()),t.append("department",l.department),t.append("year",l.year);const s=await fetch("/api/import-excel?action=upload",{method:"POST",body:t}),m=await s.json();!s.ok||!m.success?i([m.error||"Upload failed"]):(g(m.sessionId),i(m.errorMessages||[]))}catch(t){i([t.message||"Unexpected error"])}finally{d(!1)}}},N=async()=>{if(c){d(!0);try{const t=await fetch("/api/import-excel?action=confirm",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:c})}),s=await t.json();!t.ok||!s.success?i([s.error||"Confirm failed"]):u(s)}catch(t){i([t.message||"Unexpected error"])}finally{d(!1)}}};return!l||l.role!=="staff"?e("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 flex items-center justify-center",children:a("div",{className:"glass-card p-8 rounded-3xl text-center",children:[e("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),e("p",{className:"text-gray-600",children:"Only staff members can import marks."})]})}):e("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:e("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:a("div",{className:"max-w-4xl mx-auto",children:[a("div",{className:"text-center mb-8",children:[e("h1",{className:"text-4xl sm:text-5xl lg:text-6xl font-black text-gray-900 mb-4",children:"Import Student Marks"}),a("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:["Upload Excel file with student marks data for ",l.department," Department - Year ",l.year]})]}),a("div",{className:"glass-card p-8 rounded-3xl mb-8",children:[a("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-12 text-center",children:[e("svg",{className:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Drop Excel file here"}),e("p",{className:"text-gray-600 mb-6",children:"or click to browse"}),e("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:b,className:"hidden",id:"excelFile"}),e("label",{htmlFor:"excelFile",className:"glass-button px-6 py-3 text-blue-600 rounded-xl font-bold cursor-pointer inline-block",children:r?"Change File":"Choose File"}),r&&a("div",{className:"mt-4 text-gray-700",children:["Selected: ",e("span",{className:"font-semibold",children:r.name})]}),e("div",{className:"mt-6",children:e("button",{disabled:!r||n,onClick:f,className:`px-6 py-3 rounded-xl font-bold ${!r||n?"bg-gray-300 text-gray-500":"glass-button text-blue-600"}`,children:n?"Uploading...":"Upload"})})]}),c&&a("div",{className:"mt-6 p-4 bg-green-50 rounded-xl text-green-800",children:["Temporary session created. Session ID: ",e("span",{className:"font-mono",children:c}),e("div",{className:"mt-3",children:e("button",{onClick:N,disabled:n,className:`px-5 py-2 rounded-lg font-semibold ${n?"bg-gray-300 text-gray-500":"bg-green-600 text-white"}`,children:n?"Processing...":"Confirm Import"})})]}),h&&h.length>0&&a("div",{className:"mt-6 p-4 bg-red-50 rounded-xl text-red-800",children:[e("div",{className:"font-semibold mb-2",children:"Issues found:"}),e("ul",{className:"list-disc pl-6 space-y-1",children:h.map((t,s)=>e("li",{children:t},s))})]}),p&&a("div",{className:"mt-6 p-4 bg-blue-50 rounded-xl text-blue-900",children:[e("div",{className:"font-semibold mb-2",children:"Import Completed"}),a("div",{children:["Created: ",p.createdCount]})]}),a("div",{className:"mt-8 p-6 bg-blue-50 rounded-xl",children:[e("h4",{className:"text-lg font-semibold text-blue-900 mb-3",children:"Excel Format Requirements:"}),a("ul",{className:"text-blue-800 space-y-2",children:[a("li",{children:["• ",e("strong",{children:"Name"})," - Student full name"]}),a("li",{children:["• ",e("strong",{children:"RegNumber"})," - Student registration number"]}),a("li",{children:["• ",e("strong",{children:"Section"})," - Class section (A, B, etc.)"]}),a("li",{children:["• ",e("strong",{children:"ParentPhone"})," - Parent WhatsApp number"]}),a("li",{children:["• ",e("strong",{children:"Subject Columns"})," - Each subject with marks (0-100)"]})]})]})]})]})})})}export{k as default};
