import{j as t,a as s,F as R}from"./index-99957a96.js";import{r as o}from"./react-vendor-9a2eb766.js";import{d as O}from"./resultUtils-190b400a.js";function V(){const[a]=o.useState(()=>{const e=localStorage.getItem("auth");return e?JSON.parse(e):null}),[i,x]=o.useState([]),[k,b]=o.useState(!0),[g,y]=o.useState("ALL"),[u,v]=o.useState("all"),[N,C]=o.useState(new Set),[p,w]=o.useState("");o.useEffect(()=>{(a==null?void 0:a.role)==="staff"||(a==null?void 0:a.role)==="hod"?L():b(!1)},[a]);const L=async()=>{if(a){b(!0);try{let e;const r=new URLSearchParams(window.location.search),l=r.get("year"),n=r.get("includeAll")==="true",d=r.get("department");if(a.role==="hod"&&a.department==="HNS"&&!l&&!d)e=await fetch("/api/marksheets?year=I&includeAll=true");else if(a.role==="staff"){const h=(a==null?void 0:a._id)||(a==null?void 0:a.id)||localStorage.getItem("userId");e=await fetch(`/api/marksheets?staffId=${h}&includeAll=true`)}else a.role==="hod"&&(l&&n?e=await fetch(`/api/marksheets?year=${encodeURIComponent(l)}&includeAll=true`):d?e=await fetch(`/api/marksheets?department=${encodeURIComponent(d)}&includeAll=true`):e=await fetch(`/api/marksheets?department=${encodeURIComponent(a.department)}&includeAll=true`));const m=await e.json();m.success?x(m.marksheets):x([])}catch(e){console.error("Error fetching marksheets:",e),x([])}finally{b(!1)}}},c=o.useMemo(()=>{const e={};return i.forEach(r=>{var n;const l=r.examinationName||((n=r.studentDetails)==null?void 0:n.examinationName)||"Unknown Examination";e[l]||(e[l]=[]),e[l].push(r)}),Object.keys(e).forEach(r=>{e[r].sort((l,n)=>{var h,S;const d=(((h=l.studentDetails)==null?void 0:h.regNumber)||"").toString().toLowerCase(),m=(((S=n.studentDetails)==null?void 0:S.regNumber)||"").toString().toLowerCase();return d.localeCompare(m,void 0,{numeric:!0,sensitivity:"base"})})}),e},[i]),E=o.useMemo(()=>{const e={};return Object.keys(c).forEach(r=>{const l=c[r];e[r]={total:l.length,draft:l.filter(n=>n.status==="draft").length,verified:l.filter(n=>n.status==="verified_by_staff").length,requested:l.filter(n=>n.status==="dispatch_requested").length,approved:l.filter(n=>n.status==="approved_by_hod").length,dispatched:l.filter(n=>n.status==="dispatched").length,rejected:l.filter(n=>n.status==="rejected_by_hod").length,rescheduled:l.filter(n=>n.status==="rescheduled_by_hod").length}}),e},[c]),D=o.useMemo(()=>Object.keys(c).length,[c]),f=o.useMemo(()=>{let e=[];if(u==="all"?e=[...i]:e=c[u]||[],(a==null?void 0:a.role)==="hod"&&(a==null?void 0:a.department)==="HNS"&&g&&g!=="ALL"){const r=g.toString().trim().toUpperCase();e=e.filter(l=>{var n;return(((n=l.studentDetails)==null?void 0:n.department)||"").toString().trim().toUpperCase()===r})}if(p.trim()){const r=p.toLowerCase().trim();e=e.filter(l=>{var m,h;const n=(((m=l.studentDetails)==null?void 0:m.name)||"").toLowerCase(),d=(((h=l.studentDetails)==null?void 0:h.regNumber)||"").toLowerCase();return n.includes(r)||d.includes(r)})}return e.sort((r,l)=>{var m,h;const n=(((m=r.studentDetails)==null?void 0:m.regNumber)||"").toString().toLowerCase(),d=(((h=l.studentDetails)==null?void 0:h.regNumber)||"").toString().toLowerCase();return n.localeCompare(d,void 0,{numeric:!0,sensitivity:"base"})})},[i,u,c,p,g,a]),j=o.useMemo(()=>{const e=new Set;return i.forEach(r=>{var d;const l=(d=r.studentDetails)==null?void 0:d.department;if(!l)return;const n=l.toString().trim().toUpperCase();n&&e.add(n)}),Array.from(e).sort()},[i]),A=e=>{const r=new Set(N);r.has(e)?r.delete(e):r.add(e),C(r)};if(!a||a.role!=="staff"&&a.role!=="hod")return t("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 flex items-center justify-center",children:s("div",{className:"glass-card p-8 rounded-3xl text-center",children:[t("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),t("p",{className:"text-gray-600",children:"Only staff members and HODs can access records."})]})});const _=i.length,M=i.filter(e=>e.status==="verified_by_staff"||e.status==="dispatch_requested"||e.status==="rescheduled_by_hod"||e.status==="approved_by_hod"||e.status==="dispatched").length;i.filter(e=>e.status==="dispatch_requested").length;const $=i.filter(e=>e.status==="dispatched").length;return t("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 no-mobile-anim",children:t("div",{className:"responsive-container py-6 md:py-8",children:s("div",{className:"max-w-7xl mx-auto",children:[t("div",{className:"mb-6 md:mb-8",children:t("div",{className:"glass-card no-mobile-backdrop responsive-spacing rounded-3xl",children:s("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[s("div",{children:[t("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-black text-[#111418] mb-2",children:"Marksheet Records"}),s("p",{className:"text-base sm:text-lg text-gray-600",children:["View and manage all marksheet records for ",a.department," Department"]})]}),s("div",{className:"grid grid-cols-2 sm:flex sm:flex-wrap gap-2 sm:gap-3",children:[s("div",{className:"glass-card px-3 py-2 rounded-xl text-center sm:text-left",children:[t("div",{className:"text-xs text-gray-500 whitespace-nowrap",children:"Total Exams"}),t("div",{className:"text-lg sm:text-xl md:text-2xl font-bold text-theme-gold-600",children:D})]}),s("div",{className:"glass-card px-3 py-2 rounded-xl text-center sm:text-left",children:[t("div",{className:"text-xs text-gray-500 whitespace-nowrap",children:"Total Records"}),t("div",{className:"text-lg sm:text-xl md:text-2xl font-bold text-blue-600",children:_})]}),s("div",{className:"glass-card px-3 py-2 rounded-xl text-center sm:text-left",children:[t("div",{className:"text-xs text-gray-500",children:"Verified"}),t("div",{className:"text-lg sm:text-xl md:text-2xl font-bold text-green-600",children:M})]}),s("div",{className:"glass-card px-3 py-2 rounded-xl text-center sm:text-left",children:[t("div",{className:"text-xs text-gray-500",children:"Dispatched"}),t("div",{className:"text-lg sm:text-xl md:text-2xl font-bold text-purple-600",children:$})]})]})]})})}),t("div",{className:"glass-card p-4 sm:p-6 md:p-8 rounded-2xl md:rounded-3xl mb-8",children:k?s("div",{className:"text-center py-12",children:[t("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),t("p",{className:"text-gray-600",children:"Loading marksheet records..."})]}):i.length===0?s("div",{className:"text-center py-12",children:[t("svg",{className:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),t("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Records Found"}),t("p",{className:"text-gray-600",children:"Start by importing marks to create your first marksheet records."})]}):s(R,{children:[s("div",{className:"mb-8",children:[s("div",{className:"relative max-w-2xl",children:[t("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:t("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),t("input",{type:"text",placeholder:"Search name or register no...",value:p,onChange:e=>w(e.target.value),className:"w-full pl-12 pr-12 py-3.5 rounded-xl border border-gray-200 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm md:text-base transition-shadow shadow-sm hover:shadow-md placeholder:text-sm md:placeholder:text-base"}),p&&t("button",{onClick:()=>w(""),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Clear search",children:t("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),p&&t("p",{className:"mt-3 text-sm text-gray-600 font-medium",children:f.length>0?`Found ${f.length} result${f.length!==1?"s":""}`:"No results found"})]}),(a==null?void 0:a.role)==="hod"&&(a==null?void 0:a.department)==="HNS"&&s("div",{className:"mb-6",children:[t("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Filter by Department"}),s("div",{className:"flex flex-wrap gap-2",children:[s("button",{onClick:()=>y("ALL"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${g==="ALL"?"bg-yellow-600 text-white":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"}`,children:["All Departments (",i.length,")"]}),j.map(e=>s("button",{onClick:()=>y(e),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${g===e?"bg-yellow-600 text-white":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"}`,children:[e," (",i.filter(r=>{var l;return(((l=r.studentDetails)==null?void 0:l.department)||"").toString().trim().toUpperCase()===e}).length,")"]},e))]})]}),s("div",{className:"mb-8",children:[t("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Filter by Examination"}),s("div",{className:"flex flex-wrap gap-2",children:[s("button",{onClick:()=>v("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${u==="all"?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"}`,children:["All Examinations (",i.length,")"]}),Object.keys(c).sort().map(e=>s("button",{onClick:()=>v(e),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${u===e?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"}`,children:[e," (",c[e].length,")"]},e))]})]}),u==="all"&&s("div",{className:"mb-8",children:[t("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Examination Overview"}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.keys(c).sort().map(e=>{const r=E[e],l=N.has(e);return s("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[s("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>A(e),children:[s("div",{className:"flex items-center justify-between mb-2",children:[t("h4",{className:"font-semibold text-gray-900 text-sm",children:e}),t("span",{className:`transform transition-transform ${l?"rotate-180":""}`,children:"⌄"})]}),t("p",{className:"text-2xl font-bold text-blue-600",children:r.total}),t("p",{className:"text-sm text-gray-600",children:"Total Marksheets"})]}),l&&t("div",{className:"border-t border-gray-100 p-4 space-y-2",children:s("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s("div",{className:"flex items-center gap-2",children:[t("span",{className:"w-2 h-2 bg-gray-400 rounded-full"}),s("span",{children:["Draft: ",r.draft]})]}),s("div",{className:"flex items-center gap-2",children:[t("span",{className:"w-2 h-2 bg-blue-400 rounded-full"}),s("span",{children:["Verified: ",r.verified]})]}),s("div",{className:"flex items-center gap-2",children:[t("span",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),s("span",{children:["Requested: ",r.requested]})]}),s("div",{className:"flex items-center gap-2",children:[t("span",{className:"w-2 h-2 bg-green-400 rounded-full"}),s("span",{children:["Approved: ",r.approved]})]}),s("div",{className:"flex items-center gap-2",children:[t("span",{className:"w-2 h-2 bg-purple-400 rounded-full"}),s("span",{children:["Dispatched: ",r.dispatched]})]}),s("div",{className:"flex items-center gap-2",children:[t("span",{className:"w-2 h-2 bg-red-400 rounded-full"}),s("span",{children:["Issues: ",r.rejected+r.rescheduled]})]})]})})]},e)})})]}),s("div",{className:"space-y-4",children:[u!=="all"&&s("div",{className:"mb-6",children:[t("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:u}),s("p",{className:"text-gray-600",children:[f.length," marksheets found"]})]}),f.map(e=>{var r,l,n,d;return t("div",{className:"glass-card rounded-xl overflow-hidden",children:s("div",{className:"p-6",children:[t("div",{className:"flex items-start justify-between mb-3",children:s("div",{children:[t("h3",{className:"text-xl font-bold text-gray-900 mb-1",children:(r=e.studentDetails)==null?void 0:r.name}),s("p",{className:"text-sm text-gray-600",children:[(l=e.studentDetails)==null?void 0:l.regNumber," • ",U(e.studentDetails)]})]})}),s("div",{className:"flex flex-col md:grid md:grid-cols-2 lg:grid-cols-5 gap-4 md:gap-6",children:[s("div",{children:[t("p",{className:"text-gray-500 mb-1 text-xs md:text-sm",children:"Examination:"}),t("p",{className:"font-medium text-gray-900 text-sm md:text-base",children:e.examinationName||((n=e.studentDetails)==null?void 0:n.examinationName)||"—"})]}),s("div",{children:[t("p",{className:"text-gray-500 mb-1 text-xs md:text-sm",children:"Exam Date:"}),t("p",{className:"font-medium text-gray-900 text-sm md:text-base",children:e.examinationDate?new Date(e.examinationDate).toLocaleDateString("en-US",{month:"short",year:"numeric"}):(d=e.studentDetails)!=null&&d.examinationDate?new Date(e.studentDetails.examinationDate).toLocaleDateString("en-US",{month:"short",year:"numeric"}):"—"})]}),s("div",{children:[t("p",{className:"text-gray-500 mb-1 text-xs md:text-sm",children:"Overall Result:"}),t("p",{className:"font-medium text-gray-900 text-sm md:text-base",children:O(e)})]}),s("div",{children:[t("p",{className:"text-gray-500 mb-1 text-xs md:text-sm",children:"Created:"}),t("p",{className:"font-medium text-gray-900 text-sm md:text-base",children:new Date(e.createdAt).toLocaleDateString()})]}),t("div",{className:"flex items-end md:justify-end",children:t("a",{href:`/marksheets/${e._id}`,className:"w-full md:w-auto px-4 py-2 rounded-lg font-medium text-blue-600 border border-blue-200 bg-white hover:bg-blue-50 text-center text-sm transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1",children:"View Details"})})]})]})},e._id)})]})]})})]})})})}function U(a={}){const i=(a.year||"").toString(),x=(a.section||"").toString();return!i&&!x?"—":x?i?i.includes("-")?i:`${i}-${x}`:x:i}export{V as default};
