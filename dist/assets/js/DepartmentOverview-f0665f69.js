import{j as t,a as r}from"./index-a69db077.js";import{r as b}from"./react-vendor-9a2eb766.js";function Y(){const[i,J]=b.useState(()=>{const s=localStorage.getItem("auth");return s?JSON.parse(s):null}),[d,I]=b.useState(null),[K,B]=b.useState([]),[L,R]=b.useState([]),[C,O]=b.useState([]),[H,U]=b.useState(!0),E={CSE:"bg-blue-100 text-blue-800",AI_DS:"bg-indigo-100 text-indigo-800",ECE:"bg-teal-100 text-teal-800",IT:"bg-green-100 text-green-800",MECH:"bg-amber-100 text-amber-800",CIVIL:"bg-red-100 text-red-800",EEE:"bg-purple-100 text-purple-800",HNS:"bg-yellow-50 text-yellow-800"},$={CSE:{cardBg:"bg-gradient-to-br from-blue-50 to-blue-100",border:"border-blue-200",title:"text-blue-600",value:"text-blue-700",accent:"text-blue-400"},AI_DS:{cardBg:"bg-gradient-to-br from-indigo-50 to-indigo-100",border:"border-indigo-200",title:"text-indigo-600",value:"text-indigo-700",accent:"text-indigo-400"},ECE:{cardBg:"bg-gradient-to-br from-teal-50 to-teal-100",border:"border-teal-200",title:"text-teal-600",value:"text-teal-700",accent:"text-teal-400"},IT:{cardBg:"bg-gradient-to-br from-green-50 to-green-100",border:"border-green-200",title:"text-green-600",value:"text-green-700",accent:"text-green-400"},MECH:{cardBg:"bg-gradient-to-br from-amber-50 to-amber-100",border:"border-amber-200",title:"text-amber-700",value:"text-amber-800",accent:"text-amber-600"},CIVIL:{cardBg:"bg-gradient-to-br from-red-50 to-red-100",border:"border-red-200",title:"text-red-600",value:"text-red-700",accent:"text-red-400"},EEE:{cardBg:"bg-gradient-to-br from-purple-50 to-purple-100",border:"border-purple-200",title:"text-purple-600",value:"text-purple-700",accent:"text-purple-400"},HNS:{cardBg:"bg-gradient-to-br from-yellow-50 to-yellow-100",border:"border-yellow-200",title:"text-yellow-700",value:"text-yellow-800",accent:"text-yellow-600"}};b.useEffect(()=>{i&&i.role==="hod"&&z()},[i]);const z=async()=>{try{const s=i.department==="HNS"?"/api/marksheets?year=I&includeAll=true":`/api/marksheets?department=${i.department}&includeAll=true`,[g,V]=await Promise.all([fetch(s),fetch("/api/users")]),_=await g.json(),A=await V.json();if(_.success){const l=_.marksheets,w=A.success?A.users:[],m={};w.forEach(e=>{e.id&&(m[e.id]=e,m[e.id.toString()]=e),e._id&&(m[e._id]=e,m[e._id.toString()]=e)}),console.log("=== Department Overview Debug ==="),console.log("Total marksheets:",l.length),console.log("Total users fetched:",w.length),l.length>0&&console.log("Sample marksheet:",{staffId:l[0].staffId,staffName:l[0].staffName}),w.length>0&&console.log("All users:",w.map(e=>({id:e.id,name:e.name,role:e.role,year:e.year,section:e.section,department:e.department}))),console.log("UserMap keys:",Object.keys(m)),console.log("=== End Debug ===");const M=l.length,q=new Set(l.map(e=>{var a;return(a=e.studentDetails)==null?void 0:a.regNumber})).size,k={draft:l.filter(e=>e.status==="draft").length,verified:l.filter(e=>e.status==="verified_by_staff").length,pending:l.filter(e=>e.status==="dispatch_requested").length,rescheduled:l.filter(e=>e.status==="rescheduled_by_hod").length,approved:l.filter(e=>e.status==="approved_by_hod").length,rejected:l.filter(e=>e.status==="rejected_by_hod").length,dispatched:l.filter(e=>e.status==="dispatched").length},T=M>0?Math.round(k.dispatched/M*100):0,P=k.pending+k.rescheduled,S={totalMarksheets:M,totalStudents:q,byClass:{},byStatus:k,completionRate:T,pendingActions:P};l.forEach(e=>{var n;const a=((n=e.studentDetails)==null?void 0:n.year)||"Unknown";S.byClass[a]||(S.byClass[a]=0),S.byClass[a]++});const W=l.sort((e,a)=>new Date(a.updatedAt)-new Date(e.updatedAt)).slice(0,10).map(e=>{var a,n,o;return{id:e._id,student:((a=e.studentDetails)==null?void 0:a.name)||"Unknown",regNumber:((n=e.studentDetails)==null?void 0:n.regNumber)||"N/A",status:e.status,updatedAt:e.updatedAt,examination:((o=e.examination)==null?void 0:o.name)||"N/A"}}),u={},h={};l.forEach(e=>{var o,c,x,N,y;const a=(e.staffId||e.createdBy||e.userId||"Unknown").toString(),n=((o=e.studentDetails)==null?void 0:o.department)||"Unknown";if(h[n]||(h[n]={total:0,dispatched:0,pending:0,uniqueStudents:new Set,topStaff:{}}),h[n].total++,e.status==="dispatched"&&h[n].dispatched++,(e.status==="dispatch_requested"||e.status==="rescheduled_by_hod")&&h[n].pending++,(c=e.studentDetails)!=null&&c.regNumber&&h[n].uniqueStudents.add(e.studentDetails.regNumber),!u[a]){const p=m[a],D=(p==null?void 0:p.name)||e.staffName||"Unknown Staff",j=((x=e.studentDetails)==null?void 0:x.year)||null,f=((N=e.studentDetails)==null?void 0:N.section)||null;!p&&a!=="Unknown"&&(console.log("Staff not found for ID:",a),console.log("Using fallback staffName:",e.staffName)),u[a]={total:0,verified:0,dispatched:0,staffName:D,year:j,section:f}}if(h[n]){const p=h[n].topStaff[a]||{staffName:((y=u[a])==null?void 0:y.staffName)||e.staffName||"Unknown",total:0,dispatched:0};p.total++,e.status==="dispatched"&&p.dispatched++,h[n].topStaff[a]=p}u[a].total++,(e.status==="verified_by_staff"||e.status==="dispatch_requested"||e.status==="approved_by_hod"||e.status==="dispatched")&&u[a].verified++,e.status==="dispatched"&&u[a].dispatched++});const F=Object.entries(u).map(([e,a])=>{var N,y,p,D,j;const n=((N=a.year)==null?void 0:N.toString().trim())||null,o=((y=a.section)==null?void 0:y.toString().trim())||null;let c="N/A";n&&o?c=`${n}-${o}`:n?c=n:o&&(c=o),Object.keys(u).indexOf(e)===0&&console.log("First staff stats:",{id:e,staffName:a.staffName,year:a.year,section:a.section,className:c});let x=null;if(typeof m<"u"&&m&&(x=((p=m[e])==null?void 0:p.department)||((D=m[e==null?void 0:e.toString()])==null?void 0:D.department)||null,!x)){const f=Object.values(m).find(v=>v&&(String(v.id)===String(e)||String(v._id)===String(e)));x=(f==null?void 0:f.department)||null}if(!x){const f=l.find(v=>{try{return String(v.staffId)===String(e)||String(v.staffId)===e}catch{return!1}});x=((j=f==null?void 0:f.studentDetails)==null?void 0:j.department)||null}return{staffId:e,staffName:a.staffName,className:c,department:x,total:a.total,verified:a.verified,dispatched:a.dispatched,completionRate:a.total>0?Math.round(a.dispatched/a.total*100):0}}).sort((e,a)=>a.completionRate-e.completionRate),G=Object.entries(h).map(([e,a])=>{const n=Object.entries(a.topStaff||{}).map(([o,c])=>({staffId:o,staffName:c.staffName,total:c.total,dispatched:c.dispatched}));return n.sort((o,c)=>c.total-o.total),{department:e,totalMarksheets:a.total,students:a.uniqueStudents.size,dispatched:a.dispatched,pending:a.pending,completionRate:a.total>0?Math.round(a.dispatched/a.total*100):0,topStaff:n.slice(0,3)}}).sort((e,a)=>a.totalMarksheets-e.totalMarksheets);I(S),B(W),R(F),O(G)}}catch(s){console.error("Error fetching department data:",s)}finally{U(!1)}};return!i||i.role!=="hod"?t("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 flex items-center justify-center",children:r("div",{className:"glass-card p-8 rounded-3xl text-center",children:[t("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),t("p",{className:"text-gray-600",children:"Only HODs can view department overview."})]})}):t("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 no-mobile-anim",children:t("div",{className:"responsive-container py-6 md:py-8",children:r("div",{className:"max-w-7xl mx-auto",children:[t("div",{className:"mb-6 md:mb-8",children:t("div",{className:"glass-card no-mobile-backdrop responsive-spacing rounded-3xl",children:r("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[r("div",{children:[t("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-black text-[#111418] mb-2",children:"Department Overview"}),r("p",{className:"text-base sm:text-lg text-gray-600",children:["Real-time overview for ",i.department," Department"]})]}),r("div",{className:"flex flex-wrap items-center gap-3",children:[r("div",{className:"glass-card px-3 py-2 rounded-xl",children:[t("div",{className:"text-xs text-gray-500",children:"Students"}),t("div",{className:"text-xl md:text-2xl font-bold text-theme-gold-600",children:(d==null?void 0:d.totalStudents)||0})]}),r("div",{className:"glass-card px-3 py-2 rounded-xl",children:[t("div",{className:"text-xs text-gray-500",children:"Completion"}),r("div",{className:"text-xl md:text-2xl font-bold text-green-600",children:[(d==null?void 0:d.completionRate)||0,"%"]})]}),r("div",{className:"glass-card px-3 py-2 rounded-xl",children:[t("div",{className:"text-xs text-gray-500",children:"Pending"}),t("div",{className:"text-xl md:text-2xl font-bold text-yellow-600",children:(d==null?void 0:d.pendingActions)||0})]})]})]})})}),t("div",{className:"glass-card no-mobile-backdrop responsive-spacing rounded-3xl mb-6 md:mb-8",children:H?r("div",{className:"text-center py-12",children:[t("div",{className:"loading-spinner mx-auto mb-4"}),t("p",{className:"responsive-text text-gray-600",children:"Loading department data..."})]}):r("div",{className:"space-y-6 md:space-y-8",children:[r("div",{children:[r("div",{className:"flex items-center gap-2 mb-4",children:[t("svg",{className:"w-5 h-5 md:w-6 md:h-6 text-theme-gold-600 inline-flex",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{marginTop:"-2px"},children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7h18M3 12h18M3 17h18"})}),t("h2",{className:"responsive-heading-2 text-gray-900",children:"Department-wise Distribution"})]}),t("div",{className:"responsive-grid responsive-grid-2 md:grid-cols-4",children:(C&&C.length>0?C:Object.entries((d==null?void 0:d.byClass)||{}).map(([s,g])=>({department:s,totalMarksheets:g}))).map(s=>{const g=$[s.department]||{cardBg:"bg-gradient-to-br from-slate-50 to-slate-100",border:"border-slate-200",title:"text-slate-600",value:"text-slate-700",accent:"text-slate-400"};return t("div",{className:`responsive-card ${g.cardBg} border-2 ${g.border} hover:shadow-lg transition-all duration-300`,children:r("div",{className:"flex items-center justify-between",children:[r("div",{children:[t("p",{className:`text-xs md:text-sm font-medium mb-1 ${g.title}`,children:s.department}),t("p",{className:`text-2xl md:text-3xl font-bold ${g.value}`,children:s.totalMarksheets??s.count??s.total??0})]}),t("div",{children:t("span",{className:`inline-flex items-center px-2 py-0.5 text-xs font-semibold rounded-full ${E[s.department]||"bg-gray-100 text-gray-800"}`,children:s.department})})]})},s.department)})})]}),r("div",{children:[r("div",{className:"flex items-center gap-2 mb-4",children:[t("svg",{className:"w-5 h-5 md:w-6 md:h-6 text-theme-gold-600 inline-flex",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{marginTop:"-2px"},children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),t("h2",{className:"responsive-heading-2 text-gray-900",children:"Staff Performance"})]}),t("div",{className:"responsive-grid responsive-grid-2 lg:grid-cols-3",children:L.slice(0,6).map((s,g)=>r("div",{className:"responsive-card bg-gradient-to-br from-indigo-50 to-indigo-100 border-2 border-indigo-200",children:[r("div",{className:"flex items-center justify-between mb-3",children:[r("div",{className:"flex items-center gap-2",children:[t("div",{className:"w-8 h-8 bg-indigo-200 rounded-full flex items-center justify-center",children:r("span",{className:"text-sm font-bold text-indigo-700",children:["#",g+1]})}),r("div",{children:[r("div",{className:"flex items-center gap-2",children:[t("div",{className:"text-sm font-bold text-indigo-900",children:s.staffName}),s.department&&t("span",{className:`inline-flex items-center px-2 py-0.5 text-[11px] font-semibold rounded-full ${E[s.department]||"bg-gray-100 text-gray-800"} uppercase`,children:s.department})]}),t("div",{className:"text-xs text-indigo-600",children:s.className})]})]}),r("div",{className:"text-right",children:[r("div",{className:"text-2xl font-bold text-indigo-700",children:[s.completionRate,"%"]}),t("div",{className:"text-xs text-indigo-600",children:"Complete"})]})]}),r("div",{className:"grid grid-cols-3 gap-2 text-center",children:[r("div",{children:[t("div",{className:"text-lg font-bold text-indigo-900",children:s.total}),t("div",{className:"text-xs text-indigo-600",children:"Total"})]}),r("div",{children:[t("div",{className:"text-lg font-bold text-green-600",children:s.verified}),t("div",{className:"text-xs text-indigo-600",children:"Verified"})]}),r("div",{children:[t("div",{className:"text-lg font-bold text-purple-600",children:s.dispatched}),t("div",{className:"text-xs text-indigo-600",children:"Sent"})]})]})]},s.staffId))})]}),r("div",{children:[r("div",{className:"flex items-center gap-2 mb-4",children:[t("svg",{className:"w-5 h-5 md:w-6 md:h-6 text-theme-gold-600 inline-flex",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{marginTop:"-2px"},children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),t("h2",{className:"responsive-heading-2 text-gray-900",children:"Quick Actions"})]}),r("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[r("button",{onClick:()=>window.location.href="/approval-requests",className:"responsive-card group bg-gradient-to-br from-yellow-50 to-yellow-100 border-2 border-yellow-200 hover:shadow-xl transition-all duration-300 text-left",children:[r("div",{className:"flex items-start justify-between mb-3",children:[t("div",{className:"p-3 bg-yellow-100 rounded-xl group-hover:bg-yellow-200 transition-colors",children:t("svg",{className:"w-6 h-6 md:w-7 md:h-7 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),t("span",{className:"text-xs font-semibold text-yellow-600 bg-yellow-50 px-2 py-1 rounded-full",children:(d==null?void 0:d.byStatus.pending)||0})]}),t("h3",{className:"text-base md:text-lg font-bold text-yellow-900 mb-2",children:"Pending Approvals"}),t("p",{className:"text-sm text-yellow-700",children:"Review dispatch requests awaiting approval"})]}),r("button",{onClick:()=>window.location.href="/reports",className:"responsive-card group bg-gradient-to-br from-green-50 to-green-100 border-2 border-green-200 hover:shadow-xl transition-all duration-300 text-left",children:[r("div",{className:"flex items-start justify-between mb-3",children:[t("div",{className:"p-3 bg-green-100 rounded-xl group-hover:bg-green-200 transition-colors",children:t("svg",{className:"w-6 h-6 md:w-7 md:h-7 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),t("span",{className:"text-xs font-semibold text-green-600 bg-green-50 px-2 py-1 rounded-full",children:"Reports"})]}),t("h3",{className:"text-base md:text-lg font-bold text-green-900 mb-2",children:"Export Reports"}),t("p",{className:"text-sm text-green-700",children:"Generate comprehensive department analytics"})]}),r("button",{onClick:()=>{const s=(i==null?void 0:i.department)==="HNS"?"/records?year=I&includeAll=true":`/records?department=${encodeURIComponent((i==null?void 0:i.department)||"")}`;window.location.href=s},className:"responsive-card group bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-blue-200 hover:shadow-xl transition-all duration-300 text-left",children:[r("div",{className:"flex items-start justify-between mb-3",children:[t("div",{className:"p-3 bg-blue-100 rounded-xl group-hover:bg-blue-200 transition-colors",children:t("svg",{className:"w-6 h-6 md:w-7 md:h-7 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),t("span",{className:"text-xs font-semibold text-blue-600 bg-blue-50 px-2 py-1 rounded-full",children:"All"})]}),t("h3",{className:"text-base md:text-lg font-bold text-blue-900 mb-2",children:"View All Records"}),t("p",{className:"text-sm text-blue-700",children:"Browse complete department marksheets"})]})]})]})]})})]})})})}export{Y as default};
